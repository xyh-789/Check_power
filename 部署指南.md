# 部署指南

本文档详细介绍如何将寝室电量查询系统部署上线。

## 准备工作

项目已经配置好部署所需的文件：
- ✅ `package.json` - 包含依赖和启动脚本
- ✅ `.gitignore` - 排除不必要的文件
- ✅ 端口配置 - 支持动态端口（process.env.PORT）

---

## 方案一：Railway 部署（最简单，推荐）

Railway 提供免费额度，部署简单，适合小型项目。

### 步骤

1. **注册账号**
   - 访问 [https://railway.app/](https://railway.app/)
   - 使用 GitHub 账号登录

2. **上传代码到 GitHub**
   ```bash
   git init
   git add .
   git commit -m "初始提交"
   git branch -M main
   git remote add origin <你的仓库地址>
   git push -u origin main
   ```

3. **在 Railway 创建项目**
   - 点击 "New Project"
   - 选择 "Deploy from GitHub repo"
   - 选择你的仓库
   - Railway 会自动检测 Node.js 项目并部署

4. **获取部署链接**
   - 部署完成后，点击 "Generate Domain"
   - 获得类似 `https://your-app.up.railway.app` 的链接

### 优点
- 完全免费（有免费额度）
- 自动部署
- 自带 HTTPS
- 操作简单

---

## 方案二：Render 部署（免费）

Render 也提供免费服务，稳定性好。

### 步骤

1. **注册账号**
   - 访问 [https://render.com/](https://render.com/)
   - 使用 GitHub 账号登录

2. **上传代码到 GitHub**（同方案一）

3. **创建 Web Service**
   - 点击 "New +" → "Web Service"
   - 连接你的 GitHub 仓库
   - 配置如下：
     - Name: `check-power`
     - Environment: `Node`
     - Build Command: `npm install`
     - Start Command: `npm start`
   - 点击 "Create Web Service"

4. **等待部署完成**
   - 获得类似 `https://check-power.onrender.com` 的链接

### 优点
- 完全免费
- 自带 HTTPS
- 支持自动部署
- 稳定可靠

### 注意
- 免费版服务闲置 15 分钟后会休眠
- 首次访问可能需要等待几秒钟唤醒

---

## 方案三：Vercel 部署（简单但需要适配）

Vercel 主要用于部署前端，但也可以部署 Node.js API。

### 步骤

1. **创建 vercel.json**
   ```json
   {
     "version": 2,
     "builds": [
       {
         "src": "server.js",
         "use": "@vercel/node"
       }
     ],
     "routes": [
       {
         "src": "/(.*)",
         "dest": "server.js"
       }
     ]
   }
   ```

2. **安装 Vercel CLI**
   ```bash
   npm install -g vercel
   ```

3. **部署**
   ```bash
   vercel
   ```

---

## 方案四：云服务器部署（传统方式）

适合有服务器的用户，需要一定的 Linux 知识。

### 需要
- 一台 Linux 服务器（阿里云、腾讯云等）
- 服务器已安装 Node.js

### 步骤

1. **连接服务器**
   ```bash
   ssh root@你的服务器IP
   ```

2. **安装 Node.js（如果未安装）**
   ```bash
   curl -fsSL https://rpm.nodesource.com/setup_18.x | bash -
   yum install -y nodejs
   ```

3. **上传代码**
   ```bash
   # 方式一：使用 Git
   git clone <你的仓库地址>
   cd check_power
   
   # 方式二：使用 scp 上传
   scp -r ./check_power root@服务器IP:/root/
   ```

4. **安装依赖**
   ```bash
   npm install
   ```

5. **使用 PM2 保持运行**
   ```bash
   # 安装 PM2
   npm install -g pm2
   
   # 启动应用
   pm2 start server.js --name check-power
   
   # 设置开机自启
   pm2 startup
   pm2 save
   ```

6. **配置 Nginx 反向代理（可选）**
   ```nginx
   server {
       listen 80;
       server_name 你的域名;
       
       location / {
           proxy_pass http://localhost:3000;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
       }
   }
   ```

7. **开放防火墙端口**
   ```bash
   # CentOS
   firewall-cmd --permanent --add-port=3000/tcp
   firewall-cmd --reload
   
   # Ubuntu
   ufw allow 3000
   ```

### 优点
- 完全自主控制
- 性能稳定
- 可以绑定域名

### 缺点
- 需要一定的运维知识
- 服务器需要付费

---

## 推荐方案对比

| 方案 | 难度 | 费用 | 稳定性 | 推荐指数 |
|------|------|------|--------|----------|
| Railway | ⭐ | 免费 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Render | ⭐ | 免费 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Vercel | ⭐⭐ | 免费 | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 云服务器 | ⭐⭐⭐⭐ | 付费 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

**新手推荐**：Railway 或 Render

---

## 常见问题

### 1. 部署后无法访问？
- 检查防火墙设置
- 确认端口配置正确（使用 `process.env.PORT`）
- 查看部署日志

### 2. 如何绑定自己的域名？
- Railway/Render：在设置中添加自定义域名
- 云服务器：配置域名解析到服务器 IP

### 3. 如何查看运行日志？
- Railway/Render：在控制台查看 Logs
- 云服务器：`pm2 logs check-power`

### 4. 如何更新代码？
- Railway/Render：推送到 GitHub 自动部署
- 云服务器：
  ```bash
  git pull
  pm2 restart check-power
  ```

---

## 需要帮助？

如有问题，请检查：
1. Node.js 版本是否 >= 18.0.0
2. 依赖是否正确安装
3. 端口配置是否正确
4. 防火墙是否开放

